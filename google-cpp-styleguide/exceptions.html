

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>9. 規則特例 &mdash; Google 開源項目風格指南</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="Google 開源項目風格指南" href="../index.html" />
    <link rel="up" title="C++ 風格指南 - 內容目錄" href="contents.html" />
    <link rel="next" title="10. 結束語" href="end.html" />
    <link rel="prev" title="8. 格式" href="formatting.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Google 開源項目風格指南</span></a></h1>
        <h2 class="heading"><span>9. 規則特例</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="formatting.html">8. 格式</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../contents.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="end.html">10. 結束語</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="id1">
<h1>9. 規則特例</h1>
<p>前面說明的編程習慣基本都是強制性的. 但所有優秀的規則都允許例外, 這裡就是探討這些特例.</p>
<div class="section" id="id2">
<h2>9.1. 現有不合規範的代碼</h2>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">對於現有不符合既定編程風格的代碼可以網開一面.</p>
</div>
<p>當你修改使用其他風格的代碼時, 為了與代碼原有風格保持一致可以不使用本指南約定. 如果不放心可以與代碼原作者或現在的負責人員商討, 記住, <em>一致性</em> 包括原有的一致性.</p>
</div>
<div class="section" id="windows">
<span id="windows-code"></span><h2>9.2. Windows 代碼</h2>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Windows 程序員有自己的編程習慣, 主要源於 Windows 標頭檔和其它 Microsoft 代碼. 我們希望任何人都可以順利讀懂你的代碼, 所以針對所有平台的 C++ 編程只給出一個單獨的指南.</p>
</div>
<p>如果你習慣使用 Windows 編碼風格, 這兒有必要重申一下某些你可能會忘記的指南:</p>
<blockquote>
<div><ul class="simple">
<li>不要使用匈牙利命名法 (比如把整型變數命名成 <tt class="docutils literal"><span class="pre">iNum</span></tt>). 使用 Google 命名約定, 包括對源檔案使用 <tt class="docutils literal"><span class="pre">.cc</span></tt> 副檔名.</li>
<li>Windows 定義了很多原生類型的同義詞 (YuleFox 註: 這一點, 我也很反感), 如 <tt class="docutils literal"><span class="pre">DWORD</span></tt>, <tt class="docutils literal"><span class="pre">HANDLE</span></tt> 等等. 在調用 Windows API 時這是完全可以接受甚至鼓勵的. 但還是儘量使用原有的 C++ 類型, 例如, 使用 <tt class="docutils literal"><span class="pre">const</span> <span class="pre">TCHAR</span> <span class="pre">*</span></tt> 而不是 <tt class="docutils literal"><span class="pre">LPCTSTR</span></tt>.</li>
<li>使用 Microsoft Visual C++ 進行編譯時, 將警告級別設置為 3 或更高, 並將所有 warnings 當作 errors 處理.</li>
<li>不要使用 <tt class="docutils literal"><span class="pre">#pragma</span> <span class="pre">once</span></tt>; 而應該使用 Google 的標頭檔保護規則. 標頭檔保護的路徑應該相對於項目根目錄 (yospaly 註: 如 <tt class="docutils literal"><span class="pre">#ifndef</span> <span class="pre">SRC_DIR_BAR_H_</span></tt>, 參考 <a class="reference internal" href="headers.html#define-guard"><em>#define 保護</em></a> 一節).</li>
<li>除非萬不得已, 不要使用任何非標準的擴展, 如 <tt class="docutils literal"><span class="pre">#pragma</span></tt> 和 <tt class="docutils literal"><span class="pre">__declspec</span></tt>. 允許使用 <tt class="docutils literal"><span class="pre">__declspec(dllimport)</span></tt> 和 <tt class="docutils literal"><span class="pre">__declspec(dllexport)</span></tt>; 但你必須通過宏來使用, 比如 <tt class="docutils literal"><span class="pre">DLLIMPORT</span></tt> 和 <tt class="docutils literal"><span class="pre">DLLEXPORT</span></tt>, 這樣其他人在分享使用這些代碼時很容易就去掉這些擴展.</li>
</ul>
</div></blockquote>
<p>在 Windows 上, 只有很少的一些情況下, 我們可以偶爾違反規則:</p>
<blockquote>
<div><ul class="simple">
<li>通常我們 <a class="reference internal" href="classes.html#multiple-inheritance"><em>禁止使用多重繼承</em></a>, 但在使用 COM 和 ATL/WTL 類時可以使用多重繼承. 為了實現 COM 或 ATL/WTL 類/介面, 你可能不得不使用多重實現繼承.</li>
<li>雖然代碼中不應該使用異常, 但是在 ATL 和部分 STL（包括 Visual C++ 的 STL) 中異常被廣泛使用. 使用 ATL 時, 應定義 <tt class="docutils literal"><span class="pre">_ATL_NO_EXCEPTIONS</span></tt> 以禁用異常. 你要研究一下是否能夠禁用 STL 的異常, 如果無法禁用, 啟用編譯器異常也可以. (注意這只是為了編譯 STL, 自己代碼裡仍然不要含異常處理.)</li>
<li>通常為了利用標頭檔預編譯, 每個每個源檔案的開頭都會包含一個名為 <tt class="docutils literal"><span class="pre">StdAfx.h</span></tt> 或 <tt class="docutils literal"><span class="pre">precompile.h</span></tt> 的檔案. 為了使代碼方便與其他項目共享, 避免顯式包含此檔案 (<tt class="docutils literal"><span class="pre">precompile.cc</span></tt>), 使用 <tt class="docutils literal"><span class="pre">/FI</span></tt> 編譯器選項以自動包含.</li>
<li>資源標頭檔通常命名為 <tt class="docutils literal"><span class="pre">resource.h</span></tt>, 且只包含宏的, 不需要遵守本風格指南.</li>
</ul>
</div></blockquote>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="formatting.html">8. 格式</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../contents.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="end.html">10. 結束語</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright .
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>